generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                String            @id @default(uuid())
  email             String            @unique
  password          String
  role              Role              @default(USER)
  emailVerified     DateTime?
  verificationToken String?           @unique
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  name      String?
  events    BonusMalusEvent[] @relation("AdminEvents")
  team      Team?
}

model Artist {
  id         String            @id @default(uuid())
  name       String
  cost       Int
  image      String?
  totalScore Int               @default(0)
  createdAt  DateTime          @default(now())
  updatedAt  DateTime          @updatedAt
  events     BonusMalusEvent[]
  teams      Team[]            @relation("TeamArtists")
}

model Team {
  id        String       @id @default(uuid())
  name      String       @unique
  userId    String       @unique
  captainId String?
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  image     String?
  user      User         @relation(fields: [userId], references: [id])
  leagues   TeamLeague[]
  artists   Artist[]     @relation("TeamArtists")
}

model League {
  id        String       @id @default(uuid())
  name      String       @unique
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  teams     TeamLeague[]
}

model TeamLeague {
  id       String @id @default(uuid())
  teamId   String
  leagueId String
  score    Int    @default(0)
  league   League @relation(fields: [leagueId], references: [id])
  team     Team   @relation(fields: [teamId], references: [id])

  @@unique([teamId, leagueId])
}

model BonusMalusEvent {
  id          String          @id @default(uuid())
  artistId    String
  points      Int
  description String
  createdAt   DateTime        @default(now())
  createdById String?
  ruleId      String?
  artist      Artist          @relation(fields: [artistId], references: [id])
  createdBy   User?           @relation("AdminEvents", fields: [createdById], references: [id])
  rule        RuleDefinition? @relation(fields: [ruleId], references: [id])
}

model SystemSettings {
  id            String    @id @default(uuid())
  draftDeadline DateTime?
  updatedAt     DateTime  @updatedAt
}

model RuleDefinition {
  id          String            @id @default(uuid())
  category    String
  title       String
  description String
  points      Int
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  events      BonusMalusEvent[]
}

model Sponsor {
  id        String   @id @default(uuid())
  name      String
  logoUrl   String
  createdAt DateTime @default(now())
}

model News {
  id        String   @id @default(uuid())
  title     String
  content   String   @db.Text
  image     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  authorId  String?
}

enum Role {
  USER
  ADMIN
}
